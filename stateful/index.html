<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="description" content="spekka-docs">
<meta name="generator" content="Paradox, paradox-material-theme=0.6.0, mkdocs-material=3.0.3">

<meta name="lang:clipboard.copy" content="Copy to clipboard">
<meta name="lang:clipboard.copied" content="Copied to clipboard">
<meta name="lang:search.language" content="">
<meta name="lang:search.pipeline.stopwords" content="true">
<meta name="lang:search.pipeline.trimmer" content="true">
<meta name="lang:search.result.none" content="No matching documents">
<meta name="lang:search.result.one" content="1 matching document">
<meta name="lang:search.result.other" content="# matching documents">
<meta name="lang:search.tokenizer" content="">


<meta name="description" content="spekka-docs">
<link rel="shortcut icon" href="../assets/images/favicon.png">
<title>Spekka Stateful Â· Spekka</title>
<link rel="stylesheet" href="../assets/stylesheets/application.451f80e5.css">
<link rel="stylesheet" href="../lib/material__tabs/dist/mdc.tabs.min.css">
<link rel="stylesheet" href="../lib/prettify/prettify.css">
<script src="../assets/javascripts/modernizr.1aa3b519.js"></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
<style>
body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}
code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}
</style>
<link rel="stylesheet" href="../assets/fonts/font-awesome.css">
<link rel="stylesheet" href="../assets/fonts/material-icons.css">
<link rel="stylesheet" href="../assets/stylesheets/paradox-material-theme.css">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-F2ZF8EPDQ8"></script>
<script>window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());gtag('config', 'G-F2ZF8EPDQ8');</script>
</head>
<body
>
<input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
<input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
<label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
<header class="md-header" data-md-component="header">
<nav class="md-header-nav md-grid">
<div class="md-flex">
<div class="md-flex__cell md-flex__cell--shrink">
<a href="../index.html" title="Spekka" class="md-header-nav__button md-logo">
<i class="md-icon">polymer</i>
</a>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
</div>
<div class="md-flex__cell md-flex__cell--stretch">
<div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
<span class="md-header-nav__topic">
Spekka
</span>
<span class="md-header-nav__topic">
Spekka Stateful
</span>
</div>
</div>
<form name="search" style="display: none">
<input type="text" name="query">
</form>
<div class="md-flex__cell md-flex__cell--shrink">
<div class="md-header-nav__source">
<a href="https://github.com/spekka/spekka"
title="Go to repository"
class="md-source"
data-md-source="github">
<div class="md-source__icon">
<i class="fa fa-github"></i>
</div>
<div class="md-source__repository">
spekka/spekka
</div>
</a>

</div>
</div>
</div>
</nav>
</header>

<div class="md-container">
<main class="md-main">
<div class="md-main__inner md-grid" data-md-component="container">
<div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--primary" data-md-level="0" style="visibility: hidden">
<label class="md-nav__title md-nav__title--site" for="drawer">
<a href="../index.html" title="Spekka" class="md-nav__button md-logo">
<span class="md-nav__button md-logo">
<i class="md-icon">polymer</i>
</a>
<a href="../index.html" title="Spekka">
Spekka
</a>
</label>
<div class="md-nav__source">
<a href="https://github.com/spekka/spekka"
title="Go to repository"
class="md-source"
data-md-source="github">
<div class="md-source__icon">
<i class="fa fa-github"></i>
</div>
<div class="md-source__repository">
spekka/spekka
</div>
</a>

</div>
<ul>
  <li><a href="../context/index.html" class="page">Spekka Context</a>
  <ul>
    <li><a href="../context/flow-with-extended-context.html" class="page">Flow With Extended Context</a></li>
    <li><a href="../context/partitions.html" class="page">Partitions</a></li>
  </ul></li>
  <li><a href="../stateful/index.html" class="active page">Spekka Stateful</a>
  <ul>
    <li><a href="../stateful/event-based.html" class="page">Event Based Stateful Flows</a></li>
    <li><a href="../stateful/durable-state.html" class="page">Durable State Stateful Flow</a></li>
    <li><a href="../stateful/usage.html" class="page">Stateful Flow Usage</a></li>
    <li><a href="../stateful/akkapersistence.html" class="page">Spekka Stateful Akka Persistence</a></li>
    <li><a href="../stateful/sharding.html" class="page">Spekka Stateful Sharding</a></li>
  </ul></li>
</ul>
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="../stateful/index.html#spekka-stateful" class="header">Spekka Stateful</a>
  <ul>
    <li><a href="../stateful/index.html#motivation" class="header">Motivation</a></li>
    <li><a href="../stateful/index.html#overview" class="header">Overview</a></li>
  </ul></li>
</ul>
</nav>

</nav>
<ul style="display: none">
<li class="md-nav__item md-version" id="project.version">
<label class="md-nav__link" for="__version">
<i class="md-icon" title="Version">label_outline</i> 0.1.0
</label>
</li>
</ul>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="../stateful/index.html#spekka-stateful" class="header">Spekka Stateful</a>
  <ul>
    <li><a href="../stateful/index.html#motivation" class="header">Motivation</a></li>
    <li><a href="../stateful/index.html#overview" class="header">Overview</a></li>
  </ul></li>
</ul>
</nav>

</div>
</div>
</div>
<div class="md-content">
<article class="md-content__inner md-typeset">
<div class="md-content__searchable">
<h1><a href="#spekka-stateful" name="spekka-stateful" class="anchor"><span class="anchor-link"></span></a>Spekka Stateful</h1>
<p><a href="https://javadoc.io/doc/io.github.spekka/spekka-stateful_2.13/"><img src="https://javadoc.io/badge2/io.github.spekka/spekka-stateful_2.13/javadoc.svg" alt="javadoc" /></a> <a href="https://mvnrepository.com/artifact/io.github.spekka/spekka-stateful_2.13/"><img src="https://img.shields.io/maven-central/v/io.github.spekka/spekka-stateful_2.13" alt="maven" /></a></p>
<p>To use this library add the following dependencies:</p><dl class="dependency"><dt>sbt</dt><dd><pre class="prettyprint"><code class="language-scala">val AkkaVersion = "2.6.16"
libraryDependencies ++= Seq(
  "io.github.spekka" %% "spekka-stateful" % "0.1.0",
  "com.typesafe.akka" %% "akka-stream" % AkkaVersion,
  "com.typesafe.akka" %% "akka-stream-typed" % AkkaVersion,
  "com.typesafe.akka" %% "akka-actor-typed" % AkkaVersion
)</code></pre></dd><dt>Maven</dt><dd><pre class="prettyprint"><code class="language-xml">&lt;properties&gt;
  &lt;akka.version&gt;2.6.16&lt;/akka.version&gt;
  &lt;scala.binary.version&gt;2.13&lt;/scala.binary.version&gt;
&lt;/properties&gt;
&lt;dependencies&gt
  &lt;dependency&gt;
    &lt;groupId&gt;io.github.spekka&lt;/groupId&gt;
    &lt;artifactId&gt;spekka-stateful_${scala.binary.version}&lt;/artifactId&gt;
    &lt;version&gt;0.1.0&lt;/version&gt;
  &lt;/dependency&gt
  &lt;dependency&gt;
    &lt;groupId&gt;com.typesafe.akka&lt;/groupId&gt;
    &lt;artifactId&gt;akka-stream_${scala.binary.version}&lt;/artifactId&gt;
    &lt;version&gt;${akka.version}&lt;/version&gt;
  &lt;/dependency&gt
  &lt;dependency&gt;
    &lt;groupId&gt;com.typesafe.akka&lt;/groupId&gt;
    &lt;artifactId&gt;akka-stream-typed_${scala.binary.version}&lt;/artifactId&gt;
    &lt;version&gt;${akka.version}&lt;/version&gt;
  &lt;/dependency&gt
  &lt;dependency&gt;
    &lt;groupId&gt;com.typesafe.akka&lt;/groupId&gt;
    &lt;artifactId&gt;akka-actor-typed_${scala.binary.version}&lt;/artifactId&gt;
    &lt;version&gt;${akka.version}&lt;/version&gt;
  &lt;/dependency&gt
&lt;/dependencies&gt;</code></pre></dd><dt>Gradle</dt><dd><pre class="prettyprint"><code class="language-gradle">def versions = [
  AkkaVersion: "2.6.16",
  ScalaBinary: "2.13"
]
dependencies {
  implementation "io.github.spekka:spekka-stateful_${versions.ScalaBinary}:0.1.0"
  implementation "com.typesafe.akka:akka-stream_${versions.ScalaBinary}:${versions.AkkaVersion}"
  implementation "com.typesafe.akka:akka-stream-typed_${versions.ScalaBinary}:${versions.AkkaVersion}"
  implementation "com.typesafe.akka:akka-actor-typed_${versions.ScalaBinary}:${versions.AkkaVersion}"
}</code></pre></dd></dl>
<h2><a href="#motivation" name="motivation" class="anchor"><span class="anchor-link"></span></a>Motivation</h2>
<p>Working with stateful stream is at the same time a quite common and complex task.</p>
<p>While Akka Streams does offer all the required building blocks to work with stateful flows, the overall experience is hampered by the low level nature of the library: it&rsquo;s often necessary to drop down to the <code>GraphStage</code> API level to implement common tasks and in general the user its left without guidance in the design of the solution. Furthermore there is no stream native encoding of persistent stateful flows, requiring users to create their own custom solution.</p>
<p>The goal of Spekka Stateful is to provide an opinionated, stream native way to define stateful flow with the following properties:</p>
<ul>
  <li>clean distinction between business-logic and state-management</li>
  <li>structured way to interact with stateful flows from outside the stream</li>
  <li>state persistence support</li>
</ul>
<h2><a href="#overview" name="overview" class="anchor"><span class="anchor-link"></span></a>Overview</h2>
<p>The idea of the library is that a stateful flow is defined in terms of:</p>
<ul>
  <li>The business logic: <code>StatefulFlowLogic</code></li>
  <li>The way to manage the state: <code>StatefulFlowBackend</code></li>
</ul>
<p>A <code>StatefulFlowLogic[State, In, Out, Command]</code> is responsible of defining how the state is altered in response to a stream element / command: it encodes the business logic of the stream. The logic doesn&rsquo;t need to concern itself on the details of how the state is managed as this will be handled by an instance of <code>StatefulFlowBackend</code>.</p>
<p>Combining a logic and a backend instance we obtain a <code>StatefulFlowProps</code> which is a complete description of how the flow will work. Since the same stateful flow could be used for multiple purposes we need a way to tie the flow description to a specific semantic instance.</p>
<p>To achieve this we register the flow description on a <code>StatefulFlowRegistry</code> specifying the <code>entityKind</code> of the flow (i.e. which kind of entities will be computed). The <code>StatefulFlowBuilder</code> which we get as a result, encodes both how the flow works (what it computes and how it manages the state) as well as what the flow purpose is.</p>
<p>The <code>StatefulFlowBuilder</code> can now be used to obtain flow for particular <code>entityId</code> via the method <code>StatefulFlowBuilder.flow</code>. The result is a standard Akka <code>Flow</code> with a materialized value containing a <code>StatefulFlowControl</code> object which can be used to interact with the flow from outside the stream by sending <em>commands</em>.</p>
<p>The library supports 2 kinds of stateful flows:</p>
<ol>
  <li><strong>Event based:</strong> stream elements and commands do not affect the state directly, but they cause the generation of events which are then used to modify the state. This approach is well suited to implement event sourced systems.</li>
  <li><strong>Durable state:</strong> stream elements and commands do affect the state directly: a new state is returned (and if required persisted) after each message/command handling.</li>
</ol>
</div>
<div>
<a href="https://github.com/spekka/spekka/tree/v0.1.0/spekka-docs/src/main/paradox/stateful/index.md" title="Edit this page" class="md-source-file md-edit">
Edit this page
</a>
</div>
<div class="print-only">
<span class="md-source-file md-version">
0.1.0
</span>
</div>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-nav">
<nav class="md-footer-nav__inner md-grid">
<a href="../context/partitions.html" title="Partitions" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
</div>
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Previous
</span>
Partitions
</span>
</div>
</a>
<a href="../stateful/event-based.html" title="Event Based Stateful Flows" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Next
</span>
Event Based Stateful Flows
</span>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
</div>
</a>
</nav>
</div>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
<div class="md-footer-copyright__highlight">
Copyright Â© Andrea Zito
</div>
Powered by
<a href="https://github.com/lightbend/paradox">Paradox</a>
and
<a href="https://jonas.github.io/paradox-material-theme/">Paradox Material Theme</a>

</div>
<div class="md-footer-social">
<a href="https://github.com/nivox" class="md-footer-social__link fa fa-github"></a><a href="https://twitter.com/nivox" class="md-footer-social__link fa fa-twitter"></a><a href="https://linkedin.com/in/andreazito" class="md-footer-social__link fa fa-linkedin"></a>
</div>

</div>
</div>
</footer>

</div>
<script src="../assets/javascripts/application.583bbe55.js"></script>
<script src="../assets/javascripts/paradox-material-theme.js"></script>
<script>app.initialize({version:"0.17",url:{base:"../."}})</script>
<script type="text/javascript" src="../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../lib/prettify/lang-scala.js"></script>
<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function(event) {
window.prettyPrint && prettyPrint();
});
</script>

</body>
</html>
